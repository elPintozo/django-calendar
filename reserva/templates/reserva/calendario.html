{% extends 'base.html' %}
{% load static %}

{% block content %}
        <div class="row">
          <div class="col-12">
            <a class="btn btn-dark btn-lg" href="{% url 'reserva:home' %}">Home</a>
          </div>
          <div class="col-4">
            <ul class="list-group">
              <li class="list-group-item active" aria-current="true">Reservas</li>
              
              {% for reserva in reservas %}
              	<li class="list-group-item">
					<div class="card" style="width: 18rem;">
						<div class="card-body">
							<h5 class="card-title">
								Reserva Nª {{ reserva.id }}
							</h5>
							<h6 class="card-subtitle mb-2 text-muted">
								<strong>Chofer:</strong> 
								<ul class="list-group">
									<li class="list-group-item">{{ reserva.chofer.nombre }}</li>
								</ul>
								<strong>Tens:</strong>
								<ul class="list-group">
									{% for tens in reserva.tens.all %}
										<li class="list-group-item">{{ tens.nombre }}</li>
									{% endfor %}
								</ul>
							</h6>
							<p class="card-text">
								<p class="fw-normal">
									<strong>Fecha Inicio:</strong> {{ reserva.fecha_inicio|date:"d/m/Y" }}
								</p>
								<p class="fw-normal">
									<strong>Fecha Finalizacion:</strong> {{ reserva.fecha_fin|date:"d/m/Y" }}
								</p>
							</p>
							<a href="{% url 'reserva:asignacion-detail' reserva.id %}" class="btn btn-info">Ver</a>
							<a href="{% url 'reserva:asignacion-update' reserva.id %}" class="btn btn-primary">Editar</a>
						</div>
					</div>
				</li>
              {% endfor %}
                
            </ul>
          </div>
          <div class="col-8">
			<div id="calendar"></div>
          </div>
        </div>
{% endblock %}

{% block js %}
	<script src="{% static 'js/calendar/index.global.min.js' %}" ></script>
	<script src="{% static 'js/calendar/index_bootstrap5.global.min.js' %}" ></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
		  var calendarEl = document.getElementById('calendar');
	  
		  var calendar = new FullCalendar.Calendar(calendarEl, {
			headerToolbar: {
			  left: 'prev,next today',
			  center: 'title',
			  right: 'dayGridMonth',
			},
			buttonText: {
				month: 'Mes',
				today: 'Hoy'
			},
			views: {
				dayGrid: {
					titleFormat: { 
						year: 'numeric', 
						month: 'long', 
						day: '2-digit' 
					}
				}
			},
			dayHeaderFormat: { 
				weekday: 'long' 
			},
			initialDate: '{{ fecha_hoy|safe }}',
			navLinks: true, // can click day/week names to navigate views
			editable: true,
			dayMaxEvents: true, // allow "more" link when too many events
			  eventClick: function(info) {
				// código a ejecutar cuando se hace clic en un evento
				console.log('title:', info.event.title);
				console.log('start:', info.event.start);
				console.log('end:', info.event.end);
				console.log('groupId:', info.event.groupId);
			  },
			events: [
				{% for reserva in reservas %}
					{
						"groupId": "{{reserva.pk}}",
						"title": "Reserva N {{reserva.pk}}",
						"start": "{{ reserva.fecha_inicio|date:'Y-m-d' }}",
						"end": "{{ reserva.fecha_fin|date:'Y-m-d' }}",
						"backgroundColor": '#3788d8',
						"borderColor":'#000000',
						"textColor": '#FFFFF'
					}
				{% endfor %}
			]
		  });
		  calendar.setOption('locale', 'es');
		  calendar.setOption('firstDay', '1');
		  calendar.render();
		});
	  
	  </script>
{% endblock %}